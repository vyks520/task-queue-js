!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var s=t();for(var i in s)("object"==typeof exports?exports:e)[i]=s[i]}}(this,(function(){return function(){"use strict";var e={};return function(){var t=e;Object.defineProperty(t,"__esModule",{value:!0}),t.genSleepHandler=t.TaskQueue=void 0,t.TaskQueue=class{_close=!1;_queueList=[];_watchList=[];constructor(){const e=this;this.await=t=>{e.add({handler:t})},this._runLoop().then()}_sleep(e){return new Promise((t=>{setTimeout((()=>{t(!0)}),e)}))}async _runLoop(){for(;;){if(this._close)return;const e=this._queueList[0];if(e){try{await(e?.handler()),await this._execWatchList(e)}catch(e){console.error(e)}this._queueList.shift()}else await this._sleep(50)}}async _execWatchList(e){const{taskID:t}=e;if(t)for(let e=0;e<this._watchList.length;e++){const s=this._watchList[e];if(s.watchTaskID===t){try{await(s?.handler())}catch(e){console.error(e)}if(s.watchPersist)return;this._watchList.splice(e,1)}}}newAsyncHandler(e){return()=>new Promise((t=>{e((()=>{t(!0)}))}))}close(){this._close=!0}add(e){e.handler&&1===e.handler.length&&(e={...e,handler:this.newAsyncHandler(e.handler)}),e.watchTaskID?this._watchList.push(e):e.taskID?(this._queueList.forEach(((t,s)=>{t.taskID===e.taskID&&t.clean&&t.clean()})),this._queueList.push(e)):this._queueList.push(e)}await},t.genSleepHandler=function(e,t){let s,i,a=1;const n={};return n.taskID=e.taskID,n.handler=()=>{if(1===a)return a=2,new Promise((a=>{i=a,s=setTimeout((async()=>{await e.handler(),a(!0)}),t)}))},n.clean=()=>{a=-1,clearTimeout(s),i&&i(!1)},n}}(),e}()}));